# 如何设计表单
### 设计表单

以下以“日常费用报销”单为例，为您演示设计表单的操作步骤。

- 登录华炎云平台之后，首先点击“设置”，点击“流程设计器”，

- 在系统弹出的页面中，点击右上角的“新增流程”按钮，

- 输入流程名称，如“日常费用报销”，点击“好”按钮，

- 系统默认显示的是流程步骤设计页面，在窗口上方选择“表单”，

- 添加字段。报销单的第一个字段是“所在部门”，为录入的文本，所以添加一个“文本”字段。鼠标点中右侧“添加字段”标签下的“文本”，拖动到左侧的合适位置，然后松开鼠标。或者鼠标直接单击右侧“添加字段”标签下的“文本”，这时，左侧会增加一行“文本”字段。

- 鼠标选中左侧的“文本”，再点击右侧的“属性”标签，这时出现的就是“文本”字段的所有属性，可酌情修改。修改“字段名”为“所在部门”，不修改“显示名称”。在“公式”一栏的输入框内，输入“{applicant.organization.fullname}”，这样，在填写该表单时，系统将会自动显示“所在部门”为申请人所在部门。关于公式，可参考“数值型字段公式的编写”。

- 报销单的第二块是“报销明细”，其下包括数个字段，实际填写报销单时，可以增加不定行数的明细数据。所以，需要添加一个“表格”字段，并将其下字段都置于此“表格”的范围之内。鼠标点中右侧“添加字段”标签下的“表格”，拖动到左侧的合适位置，然后松开鼠标。也可以直接单击右侧“添加字段”标签下的“表格”，这时，左侧会增加一行“表格”字段。

- 鼠标选中左侧的此“表格”，点击右侧的“属性”标签，这时出现的就是“表格”字段的所有属性，可修改：“字段名”为“报销明细”，“描述”内则填上“注：若用其他发票代替，请选择实际用途。如购买办公用品由于没有发票而用车票代替，那么费用类别里应该选择办公用品。”。

- 报销明细中的第一个字段是“费用类别”，属于下拉框字段。拖动右侧“下拉框”到左侧的“报销明细”中。

- 在该下拉框属性下，修改字段名，在“输入选项”框内填上可供选择的选项（以回车为分隔），并将该字段设置为必填字段。

- 报销明细中的第二个字段是“报销金额”，属于数值字段，拖动右侧“数值”到左侧的“报销明细”中。

- 在该数值字段属性处，设置字段名、小数点位数，以及“必填”等。

- 继续为表格添加“日期”字段，并在该日期字段的属性处设置字段名为“费用产生日期”，以及设置改字段为必填字段。

- 在表格中继续添加文本字段，并在该字段的属性处设置该字段的字段名为“备注”。

- 报销单中还有一字段“报销金额合计”，为“报销明细”中的“报销金额”的合计值。所以，需要增加一个“数值”字段，并设置其值为“报销金额”的合计值。这时，我们点击表头区域，通过拖动或单击添加一个“数值”字段，设置字段名为“报销金额合计”，在公式输入栏内填入“sum({报销金额})”。这样，在填写该申请单时，输入明细的报销金额，系统会自动计算并将报销金额合计显示在“报销金额合计”处。

- 点击左侧某字段的右上角的“-”即可删除该字段。

- 上下拖动字段，则可以更改字段的上下位置。

- 在界面的左上角有“保存”和“关闭”选项。设计过程中，点击“保存”可随时保存；设计完毕后，点击“关闭”，则保存新表单的内容，并关闭“流程设计器”。

- 回到表单设置界面，将表单的“启用状态”按钮点开，即可开始使用该表单。

### 字段类型

审批单中的字段类型包括了三类：输入类字段、选择类字段、以及其他字段。

##### 1. 输入类字段

输入类字段指通过输入方式添加内容的字段，包括：

（1）   文本：适用于输入文本内容的填写框，是最常用的的字段类型，对输入内容没有限制；

（2）   数值：要求填写的内容必须是数字，适用于金额、合计等，也可用于计算公式的编写；

（3）   日期：可用于选择年月日的日期，格式为“yy-mm-dd”；

（4）   日期-时间：在日期的基础上增加了具体的几点几分；

（5）   勾选框：用于选择是或否；

（6）   邮件：用于填写邮件地址，填写的内容必须符合邮件格式；

（7）   URL：输入的内容将成为超链接，点击后可直接打开页面；

（8）   密码：在审批过程中只有赋予编辑权限的步骤可看到，其余步骤只会看到“…”。

 

##### 2. 选择类字段

选择类字段指通过选择方式添加内容的字段，包括：

（1）  下拉框：通过字段属性预置可选择的内容，只可选择一项；

（2）  选择用户：可在系统已有的用户中选择，名字将会显示在表单中，已邀请的用户无论激活与否都在选择范围内；

（3）  选择部门：可在系统已有的部门中选择，部门的全路径名字将会显示在表单中；

（4）  单选：通过字段属性可预置选择项，用户只能选择一项；

（5）  多选：通过字段属性可预置选择项，用户可选择多项。

（6）  地理位置：在移动客户端可使用，自动取得用户的当前地理位置

 

##### 3.其他类型字段说明

（1）  分组：可将说明同一事务的字段进行归类；

（2）  表格：插入一个表格，可填写明细信息等。

 

注：字段名需唯一，显示名称可以重复。

 

### 字段属性

1． 字段名：实际存放在数据库中的名字，此名字在同一张申请单中不可重复。今后公式和条件判断都将使用字段名；

2． 显示名称：审批单中实际显示的名字，同一张申请单中可重复，默认的显示名和字段名相同，用户也可自行修改；

3． 必填：必填打勾后，提交的申请单不允许为空，画布上以“*”标记。若不打勾，则在提交申请单时候可以为空；

4． 宽字段：打勾后，字段显示宽度跨两列，不打勾，字段显示宽度只有一列；

5． 默认值：根据需要，预置在字段中的值，可修改；

6． 文本字段属性：多行文本—可设置这个字段需要几行；

7． 数值字段属性：小数点位数—可设置小数点位数；

8． 公式—通过编写公式，实现数值的计算，具体可参考“公式”；

9． 勾选、多选、单选字段属性：输入选项—设置可选项；

10． 用户、部门选择字段属性：选择类型—可选一个还是多个。

 

### 字段属性之公式

给字段增加公式之后，填写审批单的时候，就无需录入此字段的值，而是由系统根据公式得到相应的值。

常见的公式包括：

- 取一个字段的值：使用“{”和“}” (注意都是半角)将字段名扩起来，如：{请假天数}
- 基于数值字段的函数：

  加：{字段名1}+{字段名2}

  减：{字段名1}-{字段名2}

  乘：{单价}*{数量}

  除：{总金额}/{数量}

- 基于表格（子表）中的数值字段的函数：

  合计:sum({费用})

  平均值：average({费用})

  计数：count({物品})

  最大值：max({费用})

  最小值：min({费用})

- 统计多选项中有几项被选中了：length({交通工具})
- 基于申请人的系统变量：包括姓名、角色、部门等

  申请人的所在部门（全路径）： {applicant.organization.fullname}

  申请人的所在部门（最底层部门名）： {applicant.organization.name}

  申请人的角色名： {applicant.roles} 

  申请人的姓名：{applicant.name} 

- 基于姓名表单字段的系统变量：包括姓名、角色、部门等

  “报销人”的所在部门（全路径）： {报销人}.organization.fullname 

  “报销人”的所在部门（最底层部门名）： {报销人}.organization.name 

  “报销人”的角色名： {报销人}.roles

  “报销人”的姓名： {报销人}.name

### 启用、停用、删除表单

- 表单新增并设计后，需要启用才可以让用户提交申请。在“流程设计器”下的“表单列表”中，点击启用状态后的开关，即可启用/停用表单。

##### 删除表单

- 进入“流程设计器”，在表单列表页中，点击表单右侧的“X”按钮
- 输入要删除的流程名称，点击“删除”按钮
- 注意：删除流程会同时删除相关的流程设置和申请单，请谨慎操作，确保不要误删除表单！

